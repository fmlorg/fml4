fml Mailing List Packeges release rivison 2.1   Bulletin

＃バグ、質問等はfml-bugs@phys.titech.ac.jpまでおねがいします。

ちなみに関連アドレスは
	fml: これ
	fml-support = fml に関するＭＬ
	fml-request, fml-bugs: 管理者いき
	fml-current, fml-src: currentのソースの送り返し

です。
	使用・改造をなさる場合は
	それ以降の直し(e.g. Bug fix, Extension)もあるので

	fml-current	を手に入れていただくとよろしいと思います。

なんでもいいからメールを

	fml-current@phys.titech.ac.jp

に送ると自動的に送り返されます。
ＩＰならanonymous ftpが御利用いただけます。

	ftp.phys.titech.ac.jp:/pub/net/fml-current

の下です。（名前はfml-current.日付.tar.gzです。日付の新しいのをどうぞ）

WWW が使えるなら

	http://www.phys.titech.ac.jp/uja/fml/

という「ＭＬサーバの設計と実装」というところを御覧下さいませ。
そこで最新版のドキュメントやらソースやらが見られます_o_


=== WHAT'S NEW  fml 2.0 current (version 2 pre release version) ===
04/25

libexec/fml_local.pl
	SECURE_FML_LOCAL

fml.pl
	FIX the behaviour when $USE_SUBJECT_AS_COMMANDS is ON

04/24

	$EXPIRE_SUMMARY を non-nil にすると summary も Expire する

04/23

fml.pl
	&CheckMember は 特殊文字を含む場合、正規表現エラーを避けるため 
	high performance 用コードを用いない

libexpire.pl
	summary の expire も行う。

04/22

libfop.pl
libutils.pl
	FIX uuencode: bad file descriptor on NetBSD 1.1B

librfc1153.pl
	カスタマイズ用の変数を外へ出す（config.phで設定できるように）

	変数				デフォールト
	$RFC1153_ISSUE    		1
	$RFC1153_LISTNAME 		UJA
	$RFC1153_VOL      		$year
	$RFC1153_SEQUENCE_FILE  	$FP_VARLOG_DIR/IssueSeq

libsendfile.pl
     $MGET_TEXT_MODE_DEFAULT 
     $MGET_BIN_MODE_DEFAULT 
	mget のデフォールトの変更

msend.pl
     $MSEND_MODE_DEFAULT 
	まとめおくりのデフォールトの変更


＊＊＊＊＊
	SAPPORO.IIJ.AD.JP へ
	ターゲットマシンは perl 4.036 on NetBSD 1.1B へ
＊＊＊＊＊


@HOSTS			複数のsendmailの走っているマシン（非常時のセカンダリも含む）
$MCI_SMTP_HOSTS = N;	@HOSTS のうち Ｎ個 のマシンのsendmail をパラレルに使って
			（理論上での限界は）Ｎ倍配送を高速化する。
			Ｎは理論上 int と同じだろうが、普通は netmask できまるわな（笑）
			でも、他のドメインでも使えるから、int までいく（理屈、理屈）
			＃とくに actives の最後の方の人はうれしい

		ばぐ： actives の中をちゃんと考えてならべないと sendmail R8 の 
			HOST_CACHE がうまくいかせない可能性あり


bin/fwix.pl
	html 形式をサポート
	今度は var/html/op/ の下に index.html と Chapeter ごとのhtml をつくる


bin/split_and_msend.pl 
	unix from のかたちの file の まとめおくり 
	ようするに obsolute の まとめおくりＲ１ の現代版（苦笑）
	PLAIN TEXT ONLY っすけど。


・ lha して uuencode する モード


・FIX libra.pl help, log
・FIX libfml.pl approve 

・ &daemon  (libutils.pl)
   は、今のプロセスをデーモンにします。
   ＃4.4BSDのdaemon()には引数がありますが、まだそれをEmulateしていません

   cron.pl を動かすんなら、これをつかうべきでは？
   ＃でも、４．３ＢＳＤでしか動作確認してないけど…

例：
$FML_EXIT_HOOK = q#
	&use('utils');
	&daemon;
	exec("$LIBDIR/bin/cron.pl $DIR -a");
#;


・ file operations は libfop.pl へ

・ # library  コマンド	（liblibrary.pl）
   put も使える 別のちょっとちがう アーカイブ操作形式


・ whois iam who コマンドを復活させました。
   hmlと実装方式は全く別ですが:-)

拡張として whois -h ほすと指定 ってのができます

# whois [-h host] key	whois で key を探す。
			host が与えられた場合はそのhostへIPCで、
			もしそうでない場合は
			ＭＬローカルな whois database を探します

# iam			自己紹介を登録する
# who			自己紹介の一覧を得る
# whois-index			同上
# whois-list			同上


・ traffic コマンド  を標準化（？）へ
作：谷川 百明生 さん  tanigawa@tribo.mech.nitech.ac.jp 
   
   [libtraffic.pl の説明]
   
     メイルの投稿量の統計をとるコマンドです。
   
   # traffic [-n <best?>] [-m <mails>] [-d]
   
   1. 月毎のメイル投稿量
   2. メイル投稿量毎の日数
   3. 時間帯別の投稿量
   4. １日２５通以上投稿があった日
   5. 投稿者ベストテン
   6. １日当たりの平均投稿量と最大投稿量
   
   を出力します。
   
     オプションで、-d を指定すると、さらに、
   
   0. 日毎の投稿量
   
   も得られます。デフォルトでは表示しません。
   
     オプション -n は、5.の投稿量の多い人のベスト何人まで表示するかを
   数字で指定します。デフォルトでは、-n 10 と同じです。
   
     オプション -m は、4.の何通以上あった日を表示するかを数字で指定し
   ます。デフォルトでは、-m 25 と同じです。


========== WHAT'S NEW  1.6 current ==========
・  尋常でないアドレスからのメールははじく
    From: が 'root|postmaster|MAILER-DAEMON|msgs|nobody|news'
    のどれかの場合 管理者へメールをフォワードして サーバは何もしない
    下手に相手に何かを返すとピンポンするかも知れないので管理者に判断は任す

    上記以外のアドレスを追加したい場合、そのアドレスを 
	$REJECT_ADDR = "|nobody|nazo-no-hito";
   のように書くと追加できる。

・ libsendfile.pl SendFile.plが旧名称

・ bin/cron.pl は 実行したらcrontab の持ち主にメールをだす （４．４）
   ４．３のようにするには $CRON_NOTIFY をオフにするか
   cron.pl DIR -b43 のように起動する 

・ libsmtp.pl  ファイルを JIS へ 自動変換（jcode.plがないときはエラーだが）

・ libutils.pl ish+lzh mode bug fix

・libref.pl  	（libexec/sid.pl の標準装備）

URL を理解するための ライブラリ
http://host/something や gopher://host/something は自力で取りにいって、
必要なら、binaryをuuencode や、ファイル分割をして送り返す。
ftp://host/something は libftp.pl へ引き渡します。 

・libftp.pl   	（libexec/sid.pl の標準装備）
ftpmail server ($FTPMAIL_SERVER を設定していないとエラー) へのリレー
するインターフェイス（ＯＫ）
	と
local spool への ftp interface 


・fml_local は分割してファイルを送り返す関数をBuilt-IN しました。
＃ libutils.pl を使うので、INCLUDE-PATH を設定する必要があります

○Backward Compatibility:
	$COMPAT_FML15 = 1; 

＊＊＊ヴァージョンアップの場合の注意＊＊＊

基本的なデータ構造を call by reference 用に書き直したので、

libcompat.pl にBackward compatibility のためのコードがあります。
昔の設定を変えたくないなら、config.ph に $COMPAT_FML15 = 1; とかくとあ
る程度まで compatible にできます。
＃コードの都合上実現できないカスタマイズもありえます_o_

FAQ は新しい形で書き直されています。

e.g.	Playing_to
	STAR_TREK_FORM
  ＊Replyt_to とかへの特別の操作を フックでやってたりすると要注意です＊
＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊


========== CHANGES  1.5 -> 1.6 ==========

・ bin/inc_via_pop.pl を経由して、fml.pl を動かすことで、
   SMTPをうけつけないマシンで ＭＬ をつくるとか
   SMTPをうけつけないマシンで .forward に相当することをやるとか
   つまり、bin/inc_via_pop.pl から fml_local.pl をよべばＯＫ

   たぶん WINDOWS NT でもうごくはずなんだけど… （実験中）


・TYPO-FIX: $USE_SUBJECT_AS_COMMANDS が正しい、$USE_SUBECT_AS_COMMANDS 
	じゃなくて

・ bin/inc_via_pop.pl 
	bin/inc_via_pop.pl -host $HOST
		は	
	/usr/local/mh/inc -noaudit -norpop -noapop -host $HOST
	と同じ（はず）です。


・ %SEVERE_ADDR_CHECK_DOMAINS

%SEVERE_ADDR_CHECK_DOMAINS = (
			      'iijnet.or.jp', 1,
			      'bekkoame.or.jp', 1,
			      'rim.or.jp', 1,
			      'win.or.jp', 1,
			      );

インターネット・プロバイダーでは 
	USERNAME@ppp.DOMAIN 
	USERNAME@MACHINE.DOMAIN 
で、jpから３階層だけチェックしたのでは充分ではない場合がある。
例：
			      'iijnet.or.jp', 1,
この連想配列は
	username@.*.iijnet.or.jp にマッチしたら
	$ADDR_MAX_CHECK を１あげる。

これの応用として、デフォールトを厳しくして、特定のドメインでは -1 する。
ってのもありですね。


・コマンドでは $TRAILER_MAILBODY 等へのインフォがデフォールトでつきます。


・コマンドを実行したメールを送り返すとき
	$PREAMBLE_MAILBODY	（前）
	$TRAILER_MAILBODY	（後）
  を本文の前後に必ず付けます。
もし、なんらかの理由で普通のメールの場合にも付けたいなら
＃それは、人の郵便をかってに開けて、人の手紙に手を加えるようなもので、
＃倫理的に許されないと思うが…世の中いろいろあるだろう〜？？？



・index コマンド
# index			get できうるファイルのリストをかえす
			index ファイルがあるのなら、それを返します

＃SID で使うんです。これ

・SID を正式に標準化する。以下の場所へファイルの移動をしました。
	libexec/sid.pl
	etc/sid.ph
	etc/sidrc
	etc/help.sid

・admin と approve コマンドで password を要求するなら
$REMOTE_ADMINISTRATION_REQUIRE_PASSWORD = 1; 
				# require password when use commands above

REMOTE_AUTH (TYPO で REMORE_AUTH) が古い変数名。
バスワードコンパチにしてあるので、どっちの変数でもいいんですけど

・ lib/SID/sid.pl

Listserv-like INTERFACE for libfml.pl and libremote.pl

＊＊＊＊＊＊要注意＊＊＊＊＊＊
・$REMOTE_ADMINISTRATION 

リモート管理する部分を 正式なコードの一部に変更して、この変数で切り替
えるようにしたので いままで eval で使ってた人 この変数をセットしてくだ
さい _o_
＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊

・$USE_SUBJECT_AS_COMMANDS = 1 ;

Subject: 行も コマンドとして使う。
例：
Subject; # mget 1-100 


・いかなる場合でも UNIX FROM なしのINPUTが来た時は、
  UNIX FROM をつける（補正）

・$PROHIBIT_COMMAND_FOR_STRANGER (<- $PROHIBIT_COMMAND_MODE)

＋エントリを使って誰にでも投稿可能にするときに 
	$PROHIBIT_COMMAND_FOR_STRANGER = 1; 
とすると、
「外部からは投稿可能＋自動登録なし＋メンバー以外はコマンドを使えない」
が実現できる。


□	libexec/fml_local.pl(独立して作動する)
~/.forward から使うためのインターフェイス  VER.2 
でも直接使うと、/usr/libexec/mail.local と同じに動く
＃でも結果論としてなんか slocal そのものみたいだな…ははは、うじゃ

slocalと違うのは、制御するファイルのFieldの数とか、正規表現が使えると
か、（必要なら fml のlibrary を呼び込んで）perlの関数を直接呼べるとか…
という upper compatibility です。

例：
＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿
# /usr/libexec/mail.local
From            fukachan        &       MailLocal
X-MLserver      fml             &       MailLocal
X-MLserver      SendFile        &       MailLocal
X-MLserver      MSendv4         &       MailLocal

# MH folders
From            fukachan@phys   |       /usr/local/lib/mh/rcvstore +inbox
To              Enterprise@phys |       /usr/local/lib/mh/rcvstore +enterprise

# File Retrieving
Subject         get\s+(\S+)     |       /usr/bin/Mail -s $F1 $From_address

# Exec ML
to              (uja)           |       $DIR/fml.pl $DIR $DIR
＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿


・ＯＳの違いによるソケットまわりのエラー
libsmtp.pl にその補正機構はbuilt-inされました。
→ 結果として sys/socket.ph へのリンクをはずす。

・EasyConfigure bug fix（thanks to sengoku@intsys.co.jp）

・ソラリス２．ｘでのソケット対策
（configure で 自動的に config.ph に $COMPAT_SOLARIS2 という変数がセッ
トされるはずですが）
	$COMPAT_SOLARIS2 = 1;
とセットしてください。
うまくシステムのsys/socket.phが呼べないときに必要な定義をします。

・bin/vipw.pl	
	config.ph の edit 用
	ヴァージョンアップの時のロックにも使えるね(^^)

・UNDERWAY (for 1.5 -> 1.6)
fml.pl へ Notification してメールをユーザーへ返す関数を移す。
libfml.pl のstatus report は↑をつかう。
~/.forward extension fixes

コマンドは user define ができるように、
まとめおくりと同様に 連想配列で設定できるようにした。
これにより、簡単にコマンドの名前等の変更もできる。



whois で sub ipc がうごかないのをＦＩＸ

おまけ： bin/geturl.pl
% bin/geturl.pl URL 
で URL の中身をとってくる（TEXTいがいはしらないよん;-) ）

RFC934 ^- -> '- -' syntax conversion


1.5からの要注意： 

$MAINTAINER が ML-admin とか ML-request とかになっていないと

	WARNING: UNIX FROM Loop

が log にでます。
＃対策は -admin みたいにする、or そのチェック部分を削る
＃ →ＦＡＱのトラブルシューティングをみてね

bug fix 
ftpmailでuuencodeがうごかない（1.5直前から〜）

				fukachan@phys.titech.ac.jp
				fml-request@phys.titech.ac.jp
